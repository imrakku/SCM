<section id="workforceOptimization" class="content-section">
    <div class="card">
        <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Workforce Optimization Analysis</h2>
        <div class="bg-teal-50 border-l-4 border-teal-500 text-teal-700 p-4 mb-6 rounded-md shadow" role="alert">
            <details>
                <summary class="font-bold text-lg text-teal-700 hover:text-teal-800">What is this section for? (Click to expand)</summary>
                <div class="mt-2">
                    <p class="text-base leading-relaxed">
                        This tool helps you find a smart balance for your delivery team size. Instead of just picking a number of agents, it analyzes how different team sizes impact delivery speed, customer service (getting orders on time), agent workload (utilization), and overall costs.
                    </p>
                    <p class="font-bold text-lg mt-3 mb-2">How does it work now?</p>
                    <p class="text-base leading-relaxed">
                        You set a target for average delivery time and select a demand profile (or use defaults). The tool then runs many quick simulations for different numbers of agents (from a minimum to a maximum you define), each time with a randomly chosen number of orders (within a range you set). For each simulated agent count, it tracks:
                    </p>
                    <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                        <li>Average delivery time.</li>
                        <li>The percentage of orders delivered *within* your target average delivery time (Service Level).</li>
                        <li>How busy the agents are (Average Agent Utilization).</li>
                        <li>The average cost to deliver each order.</li>
                    </ul>
                    <p class="text-base leading-relaxed mt-2">
                        The "Best Scenario" is chosen by first finding agent counts that meet a good service level (e.g., many orders delivered on time) and ensure a high rate of order completion. Then, from those good options, it picks the one with the lowest average cost per order. If costs are similar, it prefers a configuration where agents are well-utilized (e.g., between 60-90%) to avoid overstaffing (low utilization, high idle costs) or overworking agents (very high utilization, risk of burnout).
                    </p>
                     <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                     <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                        <li>Make sure you've run "Clustering" first to have dark stores available for selection.</li>
                        <li>Set your desired "Target Avg. Delivery Time".</li>
                        <li>Choose a "Dark Store" to optimize for.</li>
                        <li>Select a "Demand Profile" to simulate order patterns. Default profiles are available, or use one you created in the "Demand Profiles" tab.</li>
                        <li>Define the "Min/Max Orders per Iteration" for the test runs.</li>
                        <li>Specify the "Min Agents" and "Max Agents" to test.</li>
                        <li>Click "Run Workforce Optimization".</li>
                    </ul>
                    <p class="font-bold text-lg mt-3 mb-2">What you'll see:</p>
                    <p class="text-base leading-relaxed">
                        You'll get a detailed comparison table and charts showing how performance changes with different numbers of agents. The "Optimization Recommendation" section will highlight a recommended agent count based on balancing service, cost, and utilization, along with an explanation. You can also "Export Optimization Results (CSV)" for further analysis.
                    </p>
                </div>
            </details>
        </div>

        <div class="mb-8 p-6 border-2 border-blue-200 rounded-xl bg-blue-50 shadow-md">
            <h3 class="text-2xl font-semibold mb-4 text-blue-700">Optimization Parameters</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label for="optTargetDeliveryTime">Target Avg. Delivery Time (min):</label>
                    <input type="number" id="optTargetDeliveryTime" value="15" min="5" step="1" class="w-full">
                </div>
                <div class="input-group">
                    <label for="optSelectDarkStore">Select Dark Store for Scenario:</label>
                    <select id="optSelectDarkStore" class="w-full">
                        <option value="">-- Run Clustering First --</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="optDemandProfileSelect">Select Demand Profile for Optimization:</label>
                    <select id="optDemandProfileSelect" class="w-full">
                        <option value="default_opt_uniform">Default: Uniform around Store</option>
                        <option value="default_opt_focused">Default: Focused around Store</option>
                        </select>
                </div>
                 <div class="input-group" id="optOrderRadiusContainer"> <label for="optOrderGenerationRadius">Order Generation Radius (km - for default profiles):</label>
                    <input type="number" id="optOrderGenerationRadius" value="3" min="0.5" step="0.5" class="w-full">
                </div>
                <div class="input-group">
                    <label for="optMinOrdersPerIteration">Min Orders per Iteration:</label>
                    <input type="number" id="optMinOrdersPerIteration" value="8" min="1" step="1" class="w-full">
                </div>
                <div class="input-group">
                    <label for="optMaxOrdersPerIteration">Max Orders per Iteration:</label>
                    <input type="number" id="optMaxOrdersPerIteration" value="12" min="1" step="1" class="w-full">
                </div>
                <div class="input-group">
                    <label for="optMinAgents">Min Agents to Test:</label>
                    <input type="number" id="optMinAgents" value="1" min="1" max="25" step="1" class="w-full">
                </div>
                <div class="input-group">
                    <label for="optMaxAgents">Max Agents to Test:</label>
                    <input type="number" id="optMaxAgents" value="15" min="1" max="25" step="1" class="w-full">
                </div>
                 <div class="input-group md:col-span-2">
                    <label for="optMaxSimTimePerIteration">Max Sim Time per Iteration (min):</label>
                    <input type="number" id="optMaxSimTimePerIteration" value="120" min="30" step="10" class="w-full">
                </div>
            </div>
            <div class="mt-6 text-center">
                <button id="runOptimizationBtn" class="btn btn-primary">Run Workforce Optimization</button>
            </div>
        </div>
        <div id="optimizationMapContainer" class="mb-6 shadow-xl rounded-xl overflow-hidden border-2 border-slate-200 hidden">
             <h4 class="text-xl font-semibold text-center p-4 bg-slate-100 border-b border-slate-300">Scenario Map (Optimal Configuration)</h4>
            <div id="optimizationMapViz" class="w-full"></div>
        </div>
        <div id="optimizationComparisonContainer" class="optimization-results-container hidden">
            <div class="flex justify-between items-center mb-2">
                <h4 class="text-2xl font-semibold">Iteration Comparison Table</h4>
                <button id="exportWorkforceOptResultsBtn" class="btn btn-secondary btn-sm">Export Table (CSV)</button>
            </div>
            <div class="comparison-table-container">
                <table id="optimizationComparisonTable" class="comparison-table">
                    <thead>
                        <tr>
                            <th>Agents</th>
                            <th>Target Orders This Iter.</th>
                            <th>Generated Orders</th>
                            <th>Delivered Orders</th>
                            <th>Avg. Delivery Time (min)</th>
                            <th>% Orders within Target Time</th>
                            <th>Min Delivery Time (min)</th>
                            <th>Max Delivery Time (min)</th>
                            <th>Std. Dev. Delivery Time (min)</th>
                            <th>Avg. Agent Utilization (%)</th>
                            <th>Avg. Order Wait Time (min)</th>
                            <th>Undelivered Orders</th>
                            <th>Total Op. Cost (₹)</th>
                            <th>Avg. Cost/Order (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
         <div id="optimizationChartsContainer" class="hidden mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="chart-container">
                <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Delivery Time</h4>
                <canvas id="deliveryTimeChart"></canvas>
            </div>
            <div class="chart-container">
                <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Utilization</h4>
                <canvas id="utilizationChart"></canvas>
            </div>
            <div class="chart-container">
                <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Total Delivered Orders</h4>
                <canvas id="totalDeliveredOrdersChart"></canvas>
            </div>
            <div class="chart-container">
                <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Order Wait Time</h4>
                <canvas id="avgOrderWaitTimeChart"></canvas>
            </div>
            <div class="chart-container md:col-span-2">
                <h4 class="text-xl font-semibold text-center mb-2">Agents vs. % Orders within Target Time</h4>
                <canvas id="ordersWithinSlaChart"></canvas>
            </div>
        </div>
        <div id="optimizationResultsContainer" class="optimization-results-container hidden">
            <h4 class="text-2xl font-semibold text-center">Optimization Recommendation</h4>
            <div id="optimizationRecommendationText" class="mb-4 p-4 bg-sky-100 border border-sky-300 rounded-md text-sky-700">
                <p>Recommendation will appear here based on balancing service level, cost, and agent utilization.</p>
            </div>
            <div class="optimization-results-grid">
                <p><strong >Recommended Agents:</strong> <span id="optResultAgents">N/A</span></p>
                <p><strong >Achieved Avg. Delivery Time:</strong> <span id="optResultAvgTime">N/A</span></p>
                <p><strong >Target Avg. Delivery Time:</strong> <span id="optResultTargetTime">N/A</span></p>
                <p><strong >% Orders within Target:</strong> <span id="optResultSlaMet">N/A</span></p>
                <p><strong >Avg. Agent Utilization:</strong> <span id="optResultAvgUtilization">N/A</span></p>
                <p><strong >Avg. Order Wait Time:</strong> <span id="optResultAvgWaitTime">N/A</span></p>
                <p><strong >Undelivered Orders:</strong> <span id="optResultUndelivered">N/A</span></p>
            </div>
            <div class="cost-kpi-grid">
                <p><strong>Total Agent Labor Cost:</strong> <span id="optResultTotalAgentLaborCost">₹0.00</span></p>
                <p><strong>Total Travel Cost:</strong> <span id="optResultTotalTravelCost">₹0.00</span></p>
                <p><strong>Total Fixed Delivery Costs:</strong> <span id="optResultTotalFixedDeliveryCosts">₹0.00</span></p>
                <p><strong>Overall Total Operational Cost:</strong> <span id="optResultOverallTotalOperationalCost">₹0.00</span></p>
                <p><strong>Average Cost per Order:</strong> <span id="optResultAverageCostPerOrder">N/A</span></p>
            </div>
            <div class="mt-4">
                <h5 class="text-xl font-semibold text-slate-700 mb-2">Dark Store Analysis (for Recommended Scenario):</h5>
                <ul id="optDarkStoreDistances" class="list-disc list-inside space-y-1">
                </ul>
                <p class="mt-2"><strong >Overall Avg. Order-to-Store Distance:</strong> <span id="optOverallAvgDistance">N/A</span></p>
            </div>
            <h5 class="text-xl font-semibold text-slate-700 mt-6 mb-2">Optimization Log:</h5>
            <div id="optimizationLog" class="optimization-log">
                <p class="log-system"><em>[SYS] Optimization process log will appear here...</em></p>
            </div>
        </div>
    </div>
</section>
