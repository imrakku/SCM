<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Commerce Optimization Simulator</title>

    <link rel="icon" href="images/favicon.ico" type="image/x-icon"> 
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://d3js.org/d3-delaunay.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heatmap.js@2.0.5/build/heatmap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1.0.0/leaflet-heatmap.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::before { content: '► '; font-size: 0.8em; margin-right: 4px; }
        details[open] > summary::before { content: '▼ '; }

        /* AI Analysis Area Styling (reusable) */
        .ai-analysis-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #e0f2fe; /* Light blue background - Tailwind: bg-sky-100 */
            border: 1px solid #7dd3fc; /* Tailwind: border-sky-300 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .ai-analysis-container h5 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #0c4a6e; /* Tailwind: text-sky-800 */
            margin-bottom: 0.75rem;
        }
        .ai-analysis-content {
            white-space: pre-wrap; 
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #075985; /* Tailwind: text-sky-700 */
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <header class="bg-white shadow-xl sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-3xl font-extrabold text-blue-700 tracking-tight">Quick Commerce Optimization</h1>
                <div class="flex flex-wrap justify-center items-center space-x-1 sm:space-x-2 mt-3 md:mt-0">
                    <a href="#home" class="nav-link px-3 py-2">Home</a>
                    <a href="#clustering" class="nav-link px-3 py-2">Clustering</a>
                    <a href="#demandProfiles" class="nav-link px-3 py-2">Demand Profiles</a>
                    <a href="#simulation" class="nav-link px-3 py-2">Simulation</a>
                    <a href="#workforceOptimization" class="nav-link px-3 py-2">Workforce Opt.</a>
                    <a href="#scenarioAnalysis" class="nav-link px-3 py-2">Scenario Analysis</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8 mt-8">
        <section id="home" class="content-section active">
            </section>

        <section id="clustering" class="content-section">
            </section>

        <section id="demandProfiles" class="content-section">
            </section>

        <section id="simulation" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Interactive Delivery Simulation</h2>
                <div class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-700 p-4 mb-6 rounded-md shadow" role="alert">
                     <details>
                        <summary class="font-bold text-lg text-indigo-700 hover:text-indigo-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">This is the heart of the simulator! Here, you can run a live simulation of delivery operations. You'll see orders appear on the map, delivery agents pick them up from a central dark store, and deliver them to customers.</p>
                            <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li><strong>Configure Parameters:</strong> Use the sliders and dropdowns to set various operational aspects.</li>
                                <li>Click "Start Simulation". Observe the map and real-time updates in the panels.</li>
                                <li>The "Simulation Statistics" and "Cost KPIs" will summarize performance.</li>
                                <li>After a simulation, click "Analyze Simulation Results with AI" for AI-powered insights.</li>
                                <li>"Save Current Scenario Results" to compare different setups later. You can also "Export Results (CSV)" for analysis in tools like Excel.</li>
                            </ul>
                        </div>
                    </details>
                </div>
                <div class="mb-10 p-8 border-2 border-blue-300 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg">
                    <h3 class="text-2xl font-semibold mb-6 text-blue-700 text-center">Configure Simulation Parameters</h3>
                    <div class="simulation-controls-grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                        <div>
                            <div class="control-label">
                                <label for="numAgentsSlider" class="block text-md font-medium text-slate-700">Number of Agents:</label>
                                <span id="numAgentsValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="numAgentsSlider" min="1" max="10" value="5" class="mt-2">
                        </div>
                        <div>
                             <div class="control-label">
                                <label for="orderFrequencySlider" class="block text-md font-medium text-slate-700">Order Arrival Rate:</label>
                                <span id="orderFrequencyValue" class="font-bold text-xl text-blue-700">Medium</span>
                            </div>
                            <input type="range" id="orderFrequencySlider" min="1" max="5" value="3" class="mt-2">
                            <div class="text-sm text-slate-500 flex justify-between mt-1 px-1"><span>Slower</span><span></span><span>Faster</span></div>
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="agentMinSpeedSlider" class="block text-md font-medium text-slate-700">Min Agent Speed (km/h):</label>
                                <span id="agentMinSpeedValue" class="font-bold text-xl text-blue-700">20</span>
                            </div>
                            <input type="range" id="agentMinSpeedSlider" min="10" max="30" value="20" step="1" class="mt-2">
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="agentMaxSpeedSlider" class="block text-md font-medium text-slate-700">Max Agent Speed (km/h):</label>
                                <span id="agentMaxSpeedValue" class="font-bold text-xl text-blue-700">30</span>
                            </div>
                            <input type="range" id="agentMaxSpeedSlider" min="20" max="50" value="30" step="1" class="mt-2">
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="handlingTimeSlider" class="block text-md font-medium text-slate-700">Store Handling Time (min):</label>
                                <span id="handlingTimeValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="handlingTimeSlider" min="1" max="15" value="5" step="1" class="mt-2">
                        </div>
                        <div class="input-group"> <label for="orderGenerationProfileSelect" class="block text-md font-medium text-slate-700">Order Generation Profile:</label>
                            <select id="orderGenerationProfileSelect" class="mt-1">
                                <option value="default_uniform" selected>Default: Uniform City-Wide</option>
                                <option value="default_focused">Default: Focused Around Dark Store</option>
                            </select>
                        </div>
                        <div id="uniformOrderRadiusContainer" class="input-group hidden">
                            <div class="control-label">
                                <label for="uniformOrderRadiusKmSlider" class="block text-md font-medium text-slate-700">Uniform Order Radius (km):</label>
                                <span id="uniformOrderRadiusKmValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="uniformOrderRadiusKmSlider" min="1" max="10" value="5" step="0.5" class="mt-2">
                        </div>
                        <div id="defaultOrderSpreadContainer" class="hidden"> <div class="control-label">
                                <label for="orderSpreadSlider" class="block text-md font-medium text-slate-700">Order Location Spread (Default):</label>
                                <span id="orderSpreadValue" class="font-bold text-xl text-blue-700">Medium</span>
                            </div>
                            <input type="range" id="orderSpreadSlider" min="1" max="5" value="3" class="mt-2">
                             <div class="text-xs text-slate-500 flex justify-between mt-1 px-1"><span>Closer</span><span></span><span>Wider</span></div>
                        </div>
                        <div id="defaultOrderFocusRadiusContainer" class="input-group hidden"> <div class="control-label">
                                <label for="defaultOrderFocusRadiusSlider" class="block text-md font-medium text-slate-700">Focus Radius (km - Default):</label>
                                <span id="defaultOrderFocusRadiusValue" class="font-bold text-xl text-blue-700">3</span>
                            </div>
                            <input type="range" id="defaultOrderFocusRadiusSlider" min="1" max="5" value="3" step="0.5" class="mt-2">
                        </div>
                         <div class="input-group">
                            <label for="routeWaypointsSelect" class="block text-md font-medium text-slate-700">Route Complexity (Waypoints):</label>
                            <select id="routeWaypointsSelect" class="mt-1">
                                <option value="0">0 (Straight Lines)</option>
                                <option value="1" selected>1 Waypoint</option>
                                <option value="2">2 Waypoints</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="manualTrafficControl" class="block text-md font-medium text-slate-700">Base Traffic Condition:</label>
                            <select id="manualTrafficControl" class="mt-1">
                                <option value="1.0" selected>Medium (Normal)</option>
                                <option value="1.2">Light</option> <option value="0.7">Heavy</option> </select>
                        </div>
                        <div class="input-group checkbox-group items-center">
                            <input type="checkbox" id="enableDynamicTraffic" class="mr-2">
                            <label for="enableDynamicTraffic" class="text-md font-medium text-slate-700 cursor-pointer">Enable Dynamic Traffic</label>
                        </div>
                        <div class="input-group">
                            <label for="agentCostPerHour" class="block text-md font-medium text-slate-700">Agent Cost/Hour (₹):</label>
                            <input type="number" id="agentCostPerHour" value="150" min="0" step="10" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="costPerKmTraveled" class="block text-md font-medium text-slate-700">Cost/km Traveled (₹):</label>
                            <input type="number" id="costPerKmTraveled" value="5" min="0" step="0.5" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="fixedCostPerDelivery" class="block text-md font-medium text-slate-700">Fixed Cost/Delivery (₹):</label>
                            <input type="number" id="fixedCostPerDelivery" value="10" min="0" step="1" class="w-full">
                        </div>
                    </div>
                </div>
                <div class="text-center text-slate-600 mb-4">
                    Simulation Time: <span id="simTimeDisplay" class="font-semibold text-3xl text-slate-800">0</span> minutes
                    (<span id="currentTrafficStatus" class="text-sm">Traffic: Normal</span>)
                </div>
                <div class="grid lg:grid-cols-3 gap-x-8 gap-y-8">
                    <div class="lg:col-span-2 space-y-6">
                        <div id="simulationMap" class="w-full h-[500px] shadow-2xl rounded-xl overflow-hidden border-2 border-slate-200"></div>
                        <div class="flex flex-col sm:flex-row items-center justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button id="startSimBtn" class="btn btn-primary w-full sm:flex-1">Start Simulation</button>
                            <button id="pauseSimBtn" class="btn btn-secondary w-full sm:flex-1">Pause Simulation</button>
                             <button id="resetSimBtn" class="btn btn-danger w-full sm:flex-1">Reset Simulation</button>
                        </div>
                        <div class="mt-4 text-center input-group checkbox-group justify-center">
                            <input type="checkbox" id="toggleDeliveryTimeHeatmap" class="mr-2">
                            <label for="toggleDeliveryTimeHeatmap" class="text-md font-medium text-slate-700 cursor-pointer">Show Delivery Time Heatmap</label>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4 mt-4">
                            <div class="live-chart-container">
                                <h5>Pending Orders Over Time</h5>
                                <canvas id="pendingOrdersChart"></canvas>
                            </div>
                            <div class="live-chart-container">
                                <h5>Active Agents Over Time</h5>
                                <canvas id="activeAgentsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 space-y-6">
                        <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Agent Status</h4>
                            <div id="agentStatusList" class="space-y-2 text-sm max-h-60 overflow-y-auto log-container p-4 bg-white rounded-lg border border-slate-200">
                                <p class="text-slate-500 italic">Agents will appear here...</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Active Orders</h4>
                            <div id="pendingOrdersList" class="space-y-2 text-sm max-h-60 overflow-y-auto log-container p-4 bg-white rounded-lg border border-slate-200">
                                <p class="text-slate-500 italic">Active orders will appear here...</p>
                            </div>
                        </div>
                         <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Simulation Log</h4>
                            <div id="simulationLog" class="simulation-log text-xs space-y-1.5 h-72 overflow-y-auto bg-slate-900 text-slate-300 p-4 rounded-lg log-container font-mono">
                                <p class="log-system"><em>[SYS] Simulation log initialized.</em></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="simulationOverallStats" class="simulation-stats-container">
                    <h4 class="text-2xl font-semibold text-center">Simulation Statistics</h4>
                    <div class="simulation-stats-grid">
                        <p><strong >Total Orders Generated:</strong> <span id="statsTotalOrdersGenerated">0</span></p>
                        <p><strong >Total Orders Delivered:</strong> <span id="statsTotalOrdersDelivered">0</span></p>
                        <p><strong >Avg. Delivery Time:</strong> <span id="statsAvgDeliveryTime">N/A</span></p>
                        <p><strong >Min Delivery Time:</strong> <span id="statsMinDeliveryTime">N/A</span></p>
                        <p><strong >Max Delivery Time:</strong> <span id="statsMaxDeliveryTime">N/A</span></p>
                        <p><strong >Std. Dev. Delivery Time:</strong> <span id="statsStdDevDeliveryTime">N/A</span></p>
                        <p><strong >Avg. Order Wait Time:</strong> <span id="statsAvgOrderWaitTime">N/A</span></p>
                        <p><strong >Avg. Agent Utilization:</strong> <span id="statsAvgAgentUtilization">N/A</span></p>
                        <p><strong >Total Agent Travel Time:</strong> <span id="statsTotalAgentTravelTime">0</span> min</p>
                        <p><strong >Total Agent Handling Time:</strong> <span id="statsTotalAgentHandlingTime">0</span> min</p>
                        <p><strong >Total Simulation Runtime:</strong> <span id="statsTotalSimTime">0</span> min</p>
                    </div>
                    <div class="cost-kpi-grid">
                        <p><strong>Total Agent Labor Cost:</strong> <span id="statsTotalAgentLaborCost">₹0.00</span></p>
                        <p><strong>Total Travel Cost:</strong> <span id="statsTotalTravelCost">₹0.00</span></p>
                        <p><strong>Total Fixed Delivery Costs:</strong> <span id="statsTotalFixedDeliveryCosts">₹0.00</span></p>
                        <p><strong>Overall Total Operational Cost:</strong> <span id="statsOverallTotalOperationalCost">₹0.00</span></p>
                        <p><strong>Average Cost per Order:</strong> <span id="statsAverageCostPerOrder">N/A</span></p>
                    </div>
                    <div class="mt-6 flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-3">
                        <button id="saveCurrentSimScenarioBtn" class="btn btn-secondary w-full sm:w-auto">Save Current Scenario Results</button>
                        <button id="exportSimResultsBtn" class="btn btn-primary w-full sm:w-auto">Export Results (CSV)</button>
                        <button id="analyzeSimResultsAI" class="btn btn-primary w-full sm:w-auto bg-sky-500 hover:bg-sky-600 border-sky-500 hover:border-sky-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars mr-2" viewBox="0 0 16 16">
                                <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.31l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.31A1.734 1.734 0 0 0 2.31 4.213l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                            </svg>
                            Analyze with AI
                        </button>
                    </div>
                </div>
                <div id="simulationAiAnalysisContainer" class="ai-analysis-container hidden mt-6">
                    <h5>AI-Powered Simulation Analysis:</h5>
                    <div id="simulationAiAnalysisLoading" class="loading-spinner hidden"></div>
                    <div id="simulationAiAnalysisContent" class="ai-analysis-content">
                        Click "Analyze with AI" to get insights on your simulation results.
                    </div>
                </div>
            </div>
        </section>

        <section id="workforceOptimization" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Workforce Optimization Analysis</h2>
                <div class="bg-teal-50 border-l-4 border-teal-500 text-teal-700 p-4 mb-6 rounded-md shadow" role="alert">
                     <details>
                        <summary class="font-bold text-lg text-teal-700 hover:text-teal-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">
                                This tool helps find a balance for delivery team size by analyzing how different team sizes impact delivery speed, service levels, agent utilization, and costs, using realistic demand patterns.
                            </p>
                            <p class="font-bold text-lg mt-3 mb-2">How it Works:</p>
                            <p class="text-base leading-relaxed">
                                You set a target for average delivery time and select a demand profile. The tool then runs multiple quick simulations for each agent count. For each, it generates orders based on the chosen profile over a set simulation time and calculates the average performance. The "Best Scenario" is recommended by balancing service, cost, and utilization.
                            </p>
                        </div>
                    </details>
                </div>

                <div class="mb-8 p-6 border-2 border-blue-200 rounded-xl bg-blue-50 shadow-md">
                    <h3 class="text-2xl font-semibold mb-4 text-blue-700">Optimization Parameters</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="optTargetDeliveryTime">Target Avg. Delivery Time (min):</label>
                            <input type="number" id="optTargetDeliveryTime" value="15" min="5" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optSelectDarkStore">Select Dark Store for Scenario:</label>
                            <select id="optSelectDarkStore" class="w-full">
                                <option value="">-- Run Clustering First --</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="optDemandProfileSelect">Select Demand Profile for Optimization:</label>
                            <select id="optDemandProfileSelect" class="w-full">
                                <option value="default_opt_uniform">Default: Uniform around Store</option>
                                <option value="default_opt_focused">Default: Focused around Store</option>
                            </select>
                        </div>
                         <div class="input-group" id="optOrderRadiusContainer">
                            <label for="optOrderGenerationRadius">Order Generation Radius (km - for default profiles):</label>
                            <input type="number" id="optOrderGenerationRadius" value="3" min="0.5" step="0.5" class="w-full">
                        </div>
                        <div class="input-group" id="optTargetOrdersContainer">
                            <label for="optTargetOrdersPerIteration">Target Orders per Iteration (for default profiles):</label>
                            <input type="number" id="optTargetOrdersPerIteration" value="20" min="5" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMinAgents">Min Agents to Test:</label>
                            <input type="number" id="optMinAgents" value="1" min="1" max="50" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMaxAgents">Max Agents to Test:</label>
                            <input type="number" id="optMaxAgents" value="15" min="1" max="50" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optNumRunsPerAgentCount">Number of Simulation Runs per Agent Count:</label>
                            <input type="number" id="optNumRunsPerAgentCount" value="3" min="1" max="10" step="1" class="w-full">
                        </div>
                         <div class="input-group">
                            <label for="optMaxSimTimePerIteration">Max Sim Time per Iteration (min):</label>
                            <input type="number" id="optMaxSimTimePerIteration" value="120" min="30" step="10" class="w-full">
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="runOptimizationBtn" class="btn btn-primary">Run Workforce Optimization</button>
                    </div>
                </div>
                <div id="optimizationMapContainer" class="mb-6 shadow-xl rounded-xl overflow-hidden border-2 border-slate-200 hidden">
                     <h4 class="text-xl font-semibold text-center p-4 bg-slate-100 border-b border-slate-300">Scenario Map (Optimal Configuration)</h4>
                    <div id="optimizationMapViz" class="w-full h-[400px]"></div>
                </div>
                <div id="optimizationComparisonContainer" class="optimization-results-container hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-2xl font-semibold">Iteration Comparison Table (Averaged Results)</h4>
                        <button id="exportWorkforceOptResultsBtn" class="btn btn-secondary btn-sm">Export Table (CSV)</button>
                    </div>
                    <div class="comparison-table-container">
                        <table id="optimizationComparisonTable" class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Agents</th>
                                    <th>Avg. Generated Orders</th>
                                    <th>Avg. Delivered Orders</th>
                                    <th>Avg. Delivery Time (min)</th>
                                    <th>Avg. % Orders within Target</th>
                                    <th>Avg. Min Delivery Time (min)</th>
                                    <th>Avg. Max Delivery Time (min)</th>
                                    <th>Avg. Std. Dev. Delivery Time (min)</th>
                                    <th>Avg. Agent Utilization (%)</th>
                                    <th>Avg. Order Wait Time (min)</th>
                                    <th>Avg. Undelivered Orders</th>
                                    <th>Avg. Total Op. Cost (₹)</th>
                                    <th>Avg. Cost/Order (₹)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                 <div id="optimizationChartsContainer" class="hidden mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Delivery Time</h4>
                        <canvas id="deliveryTimeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Utilization</h4>
                        <canvas id="utilizationChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Total Delivered Orders</h4>
                        <canvas id="totalDeliveredOrdersChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Order Wait Time</h4>
                        <canvas id="avgOrderWaitTimeChart"></canvas>
                    </div>
                    <div class="chart-container md:col-span-2">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. % Orders within Target Time</h4>
                        <canvas id="ordersWithinSlaChart"></canvas>
                    </div>
                </div>

                <div id="optimizationResultsContainer" class="optimization-results-container hidden">
                    <h4 class="text-2xl font-semibold text-center">Optimization Recommendation</h4>
                    <div id="optimizationRecommendationText" class="mb-4 p-4 bg-sky-100 border border-sky-300 rounded-md text-sky-700">
                        <p>Recommendation will appear here based on balancing service level, cost, and agent utilization.</p>
                    </div>
                    <div class="optimization-results-grid">
                        <p><strong >Recommended Agents:</strong> <span id="optResultAgents">N/A</span></p>
                        <p><strong >Achieved Avg. Delivery Time:</strong> <span id="optResultAvgTime">N/A</span></p>
                        <p><strong >Target Avg. Delivery Time:</strong> <span id="optResultTargetTime">N/A</span></p>
                        <p><strong >% Orders within Target:</strong> <span id="optResultSlaMet">N/A</span></p>
                        <p><strong >Avg. Agent Utilization:</strong> <span id="optResultAvgUtilization">N/A</span></p>
                        <p><strong >Avg. Order Wait Time:</strong> <span id="optResultAvgWaitTime">N/A</span></p>
                        <p><strong >Undelivered Orders:</strong> <span id="optResultUndelivered">N/A</span></p>
                    </div>
                    <div class="cost-kpi-grid">
                        <p><strong>Total Agent Labor Cost:</strong> <span id="optResultTotalAgentLaborCost">₹0.00</span></p>
                        <p><strong>Total Travel Cost:</strong> <span id="optResultTotalTravelCost">₹0.00</span></p>
                        <p><strong>Total Fixed Delivery Costs:</strong> <span id="optResultTotalFixedDeliveryCosts">₹0.00</span></p>
                        <p><strong>Overall Total Operational Cost:</strong> <span id="optResultOverallTotalOperationalCost">₹0.00</span></p>
                        <p><strong>Average Cost per Order:</strong> <span id="optResultAverageCostPerOrder">N/A</span></p>
                    </div>
                    <div class="mt-4">
                        <h5 class="text-xl font-semibold text-slate-700 mb-2">Dark Store Analysis (for Recommended Scenario):</h5>
                        <ul id="optDarkStoreDistances" class="list-disc list-inside space-y-1">
                        </ul>
                        <p class="mt-2"><strong >Overall Avg. Order-to-Store Distance:</strong> <span id="optOverallAvgDistance">N/A</span></p>
                    </div>
                    <div class="mt-6 text-center">
                         <button id="analyzeWorkforceOptAI" class="btn btn-primary w-full sm:w-auto bg-sky-500 hover:bg-sky-600 border-sky-500 hover:border-sky-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars mr-2" viewBox="0 0 16 16">
                                <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.31l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.31A1.734 1.734 0 0 0 2.31 4.213l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                            </svg>
                            Analyze Optimization with AI
                        </button>
                    </div>
                    <div id="workforceOptAiAnalysisContainer" class="ai-analysis-container hidden mt-6">
                        <h5>AI-Powered Optimization Analysis:</h5>
                        <div id="workforceOptAiAnalysisLoading" class="loading-spinner hidden"></div>
                        <div id="workforceOptAiAnalysisContent" class="ai-analysis-content">
                            Click "Analyze Optimization with AI" to get insights on your optimization results.
                        </div>
                    </div>
                    <h5 class="text-xl font-semibold text-slate-700 mt-6 mb-2">Optimization Log:</h5>
                    <div id="optimizationLog" class="optimization-log">
                        <p class="log-system"><em>[SYS] Optimization process log will appear here...</em></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenarioAnalysis" class="content-section">
            </section>
    </main>

    <footer class="text-center py-16 mt-12 bg-slate-900 text-slate-400">
        <p class="text-slate-300 text-lg">&copy; <span id="currentYear"></span> Rakshit Monga - IIM Sirmaur.</p>
        <p class="text-md mt-2">Quick Commerce Optimization Project</p>
        <div class="mt-8">
            <button id="toggleSectorCoordsBtn" class="btn btn-secondary btn-sm">Show/Hide Sector Coordinates</button>
            <div id="sectorCoordinatesContainer" class="hidden mt-4 text-left max-w-2xl mx-auto bg-slate-800 p-4 rounded-lg text-sm">
                <h4 class="text-lg font-semibold text-slate-200 mb-2 text-center">Chandigarh Sector Coordinates (Approximate Centers)</h4>
                <pre id="sectorCoordinatesList" class="text-slate-300 whitespace-pre-wrap"></pre>
            </div>
        </div>
    </footer>

    <script type="module" src="js/main.js"></script>
</body>
</html>
