<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chandigarh Logistics Sim - Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1.0.0/leaflet-heatmap.js"></script>
    <script src="https://d3js.org/d3-delaunay.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heatmap.js@2.0.5/build/heatmap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Custom styles for <details> summary arrow */
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::before { content: '► '; font-size: 0.8em; margin-right: 4px; }
        details[open] > summary::before { content: '▼ '; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800"> <header class="bg-white shadow-xl sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-3xl font-extrabold text-blue-700 tracking-tight">Chandigarh Logistics Sim</h1>
                <div class="flex flex-wrap justify-center items-center space-x-1 sm:space-x-2 mt-3 md:mt-0">
                    <a href="#home" class="nav-link px-3 py-2">Home</a>
                    <a href="#clustering" class="nav-link px-3 py-2">Clustering</a>
                    <a href="#demandProfiles" class="nav-link px-3 py-2">Demand Profiles</a>
                    <a href="#simulation" class="nav-link px-3 py-2">Simulation</a>
                    <a href="#workforceOptimization" class="nav-link px-3 py-2">Workforce Opt.</a>
                    <a href="#scenarioAnalysis" class="nav-link px-3 py-2">Scenario Analysis</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8 mt-8">
        <section id="home" class="content-section active">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Welcome to the Chandigarh Logistics Simulator!</h2>
                <p class="mb-4 text-lg leading-relaxed text-slate-600">
                    This tool is designed to help understand and optimize last-mile delivery operations within Chandigarh. It allows you to explore different aspects of logistics planning, from identifying ideal locations for small warehouses (dark stores) to simulating daily delivery activities and figuring out the best number of delivery agents.
                </p>
                <details class="mb-6 text-lg text-slate-600">
                    <summary class="font-semibold text-blue-600 hover:text-blue-700">Learn more about the modules...</summary>
                    <p class="mt-2 mb-2 leading-relaxed">
                        Navigate through the tabs above to access different modules:
                    </p>
                    <ol class="list-decimal list-inside space-y-3 leading-relaxed">
                        <li class="pl-2"><strong class="text-slate-700">Clustering:</strong> Find optimal dark store locations based on simulated customer demand.</li>
                        <li class="pl-2"><strong class="text-slate-700">Demand Profiles:</strong> Create and save different patterns of customer orders to test various scenarios.</li>
                        <li class="pl-2"><strong class="text-slate-700">Simulation:</strong> Watch a real-time simulation of deliveries, adjust parameters like agent numbers and order frequency, and see the impact on performance and costs.</li>
                         <li class="pl-2"><strong class="text-slate-700">Workforce Optimization:</strong> Analyze how many delivery agents you might need to meet service targets efficiently, considering costs and utilization.</li>
                         <li class="pl-2"><strong class="text-slate-700">Scenario Analysis:</strong> Compare the results from different simulation runs to make informed decisions.</li>
                    </ol>
                </details>
                <p class="mb-8 text-lg leading-relaxed text-slate-600">
                    The goal is to provide data-driven insights for better resource allocation, faster deliveries, and improved customer satisfaction. This project was developed by Rakshit Monga as part of studies at the Indian Institute of Management Sirmaur.
                </p>
                <div class="bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 p-8 rounded-xl border border-blue-200 shadow-lg">
                    <h3 class="text-2xl font-semibold mb-4 text-blue-800">Project Lead</h3>
                    <ul class="list-none space-y-1.5 text-slate-700 text-lg">
                        <li class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 mr-3 text-blue-600">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                            </svg>
                            Rakshit Monga
                        </li>
                    </ul>
                    <p class="mt-4 text-sm text-slate-500 italic">Indian Institute of Management Sirmaur</p>
                </div>
            </div>
        </section>

        <section id="clustering" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Demand Clustering & Dark Store Placement</h2>
                 <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 mb-6 rounded-md shadow" role="alert">
                    <details>
                        <summary class="font-bold text-lg text-blue-700 hover:text-blue-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">This section helps you identify potentially optimal locations for "dark stores" (small, local warehouses for quick delivery) within Chandigarh. It does this by simulating customer order locations and then grouping them to find central points for these stores.</p>
                            <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li>Set the number of general "Background Orders" spread across the city.</li>
                                <li>Set the number of "Hotspot Orders" concentrated in specific busy areas.</li>
                                <li>Specify how many "Number of Dark Stores" you want the system to identify.</li>
                                <li>Click "Regenerate Clustering Data". The map will show simulated orders (dots), identified dark store locations (red markers), and their approximate service areas (Voronoi cells).</li>
                                <li>You can toggle "Show Order-to-Store Connections" to see which orders are assigned to which store.</li>
                                <li>Review the statistics below the map for insights into order distribution and distances.</li>
                            </ul>
                            <p class="font-bold text-lg mt-3 mb-2">What you'll see:</p>
                            <p class="text-base leading-relaxed">The map visualizes potential dark store locations based on your inputs. The statistics provide data on how well these locations cover the simulated demand, helping you understand service efficiency. These dark stores can then be used in the "Workforce Optimization" section.</p>
                        </div>
                    </details>
                </div>
                 <div class="mb-8 p-6 border-2 border-blue-200 rounded-xl bg-slate-50 shadow-md">
                    <h3 class="text-2xl font-semibold mb-4 text-blue-700">Configure Clustering Parameters</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="input-group">
                            <label for="numBackgroundOrders">Background Orders:</label>
                            <input type="number" id="numBackgroundOrders" value="700" min="0" step="50" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="numHotspotOrders">Hotspot Orders:</label>
                            <input type="number" id="numHotspotOrders" value="300" min="0" step="50" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="numDarkStoresForClustering">Number of Dark Stores:</label>
                            <input type="number" id="numDarkStoresForClustering" value="10" min="1" max="25" step="1" class="w-full">
                        </div>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-8 mb-10">
                    <div class="stat-card text-center p-8">
                        <h4 class="font-semibold text-xl mb-2 text-slate-500">Total Orders Simulated</h4>
                        <p id="totalOrdersDisplayClustering" class="text-5xl font-extrabold text-blue-600">1000</p>
                    </div>
                    <div class="stat-card text-center p-8">
                        <h4 class="font-semibold text-xl mb-2 text-slate-500">Dark Stores Identified</h4>
                        <p id="numDarkStoresDisplay" class="text-5xl font-extrabold text-blue-600">10</p>
                    </div>
                </div>
                <div id="clusteringMapVizContainer" class="mb-6 shadow-2xl rounded-xl overflow-hidden border-2 border-slate-200">
                    <div id="clusteringMapViz" class="w-full"></div>
                </div>
                 <div class="mb-4 text-center">
                    <label class="checkbox-label">
                        <input type="checkbox" id="showOrderConnectionsToggle"> Show Order-to-Store Connections
                    </label>
                </div>
                <p class="text-md text-slate-500 mb-6 italic text-center">
                    Map Key: Chandigarh Boundary (Dark Outline), Voronoi Cell Outlines (Blue Lines), Orders (Blue/Purple Circles), Dark Stores (Red Markers).
                </p>
                 <div class="text-center">
                    <button id="regenerateClusteringBtn" class="btn btn-primary">Regenerate Clustering Data</button>
                 </div>
                 <div id="clusteringStats" class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm bg-slate-100 p-6 rounded-lg border border-slate-200 shadow-inner">
                    <p class="italic text-slate-500 md:col-span-2 lg:col-span-3 text-center">Cluster statistics will appear here after generation.</p>
                 </div>
                 <div id="overallClusteringStats" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-center">
                     <p><strong class="text-blue-700">Overall Average Order-to-Store Distance:</strong> <span id="overallAvgClusterDistance" class="font-semibold">N/A</span></p>
                     <p><strong class="text-blue-700">Overall Min Distance:</strong> <span id="overallMinClusterDistance" class="font-semibold">N/A</span></p>
                     <p><strong class="text-blue-700">Overall Max Distance:</strong> <span id="overallMaxClusterDistance" class="font-semibold">N/A</span></p>
                     <p><strong class="text-blue-700">Overall Std. Dev. Distance:</strong> <span id="overallStdDevClusterDistance" class="font-semibold">N/A</span></p>
                 </div>
            </div>
        </section>

        <section id="demandProfiles" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Custom Demand Profiles</h2>
                <div class="bg-sky-50 border-l-4 border-sky-500 text-sky-700 p-4 mb-6 rounded-md shadow" role="alert">
                    <details>
                        <summary class="font-bold text-lg text-sky-700 hover:text-sky-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">This section allows you to create and save different "demand profiles" – patterns of how customer orders might arise across Chandigarh. For example, you could create a profile for "Evening Rush in Sector 17" or "Weekend Orders City-Wide."</p>
                            <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li>Give your profile a unique "Profile Name".</li>
                                <li>Click "Add Zone" to define areas and times for order generation. For each zone, you can specify:
                                    <ul class="list-disc list-inside ml-6 text-sm">
                                        <li><strong>Zone Type:</strong> Uniform (city-wide), Hotspot (around a point), Sector-based, or Route-based.</li>
                                        <li><strong>Min/Max Orders:</strong> How many orders to generate in this zone during its active time.</li>
                                        <li><strong>Start/End Time:</strong> When this zone is active during the simulation (in simulation minutes).</li>
                                        <li>For Hotspots/Routes, you can click on the small map to define centers or points.</li>
                                    </ul>
                                </li>
                                <li>Click "Save Profile". It will appear in the "Saved Profiles" list on the right.</li>
                                <li>These custom profiles can then be selected in the "Simulation" tab to see how your logistics network performs under different demand conditions.</li>
                            </ul>
                            <p class="text-sm mt-2 italic">Note: Profiles are currently saved for your current browser session only.</p>
                        </div>
                    </details>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-blue-700">Create/Edit Profile</h3>
                        <div class="input-group">
                            <label for="profileNameInput">Profile Name:</label>
                            <input type="text" id="profileNameInput" placeholder="e.g., Evening Rush Sector 17" class="w-full">
                        </div>
                        <div id="profileZonesContainer" class="space-y-4 mb-4">
                        </div>
                        <button id="addZoneToProfileBtn" class="btn btn-secondary btn-sm mb-4">Add Zone</button>
                        <div class="flex space-x-2">
                            <button id="saveProfileBtn" class="btn btn-primary">Save Profile</button>
                            <button id="clearProfileFormBtn" class="btn btn-danger btn-sm">Clear Form</button>
                        </div>
                         <div id="profileCreationMapContainer" class="mt-6 hidden">
                            <h4 class="text-lg font-semibold text-center mb-2 text-slate-600">Set Hotspot/Route Point</h4>
                            <div id="profileCreationMap"></div>
                            <p class="text-sm text-center text-slate-500 mt-2">Click on map to set hotspot center or route points.</p>
                            <button id="finishCurrentRouteBtn" class="btn btn-secondary btn-sm mt-2 hidden">Finish Current Route Segment</button>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-blue-700">Saved Profiles</h3>
                        <div id="savedProfilesListContainer" class="max-h-96 overflow-y-auto bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <ul id="savedProfilesList" class="list-none space-y-2">
                                <li class="italic text-slate-500">No custom profiles saved yet.</li>
                            </ul>
                        </div>
                         <p class="text-sm text-slate-500 mt-4 italic">Note: Profiles are stored for the current session only using browser's session storage.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="simulation" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Interactive Delivery Simulation</h2>
                <div class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-700 p-4 mb-6 rounded-md shadow" role="alert">
                     <details>
                        <summary class="font-bold text-lg text-indigo-700 hover:text-indigo-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">This is the heart of the simulator! Here, you can run a live simulation of delivery operations. You'll see orders appear on the map, delivery agents pick them up from a central dark store, and deliver them to customers.</p>
                            <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li><strong>Configure Parameters:</strong> Use the sliders and dropdowns to set various operational aspects.</li>
                                <li>Click "Start Simulation". Observe the map and real-time updates in the panels.</li>
                                <li>The "Simulation Statistics" and "Cost KPIs" will summarize performance.</li>
                                <li>"Save Current Scenario Results" to compare different setups later. You can also "Export Results (CSV)" for analysis in tools like Excel.</li>
                            </ul>
                        </div>
                    </details>
                </div>
                <div class="mb-10 p-8 border-2 border-blue-300 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg">
                    <h3 class="text-2xl font-semibold mb-6 text-blue-700 text-center">Configure Simulation Parameters</h3>
                    <div class="simulation-controls-grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                        <div>
                            <div class="control-label">
                                <label for="numAgentsSlider" class="block text-md font-medium text-slate-700">Number of Agents:</label>
                                <span id="numAgentsValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="numAgentsSlider" min="1" max="10" value="5" class="mt-2">
                        </div>
                        <div>
                             <div class="control-label">
                                <label for="orderFrequencySlider" class="block text-md font-medium text-slate-700">Order Arrival Rate:</label>
                                <span id="orderFrequencyValue" class="font-bold text-xl text-blue-700">Medium</span>
                            </div>
                            <input type="range" id="orderFrequencySlider" min="1" max="5" value="3" class="mt-2">
                            <div class="text-sm text-slate-500 flex justify-between mt-1 px-1"><span>Slower</span><span></span><span>Faster</span></div>
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="agentMinSpeedSlider" class="block text-md font-medium text-slate-700">Min Agent Speed (km/h):</label>
                                <span id="agentMinSpeedValue" class="font-bold text-xl text-blue-700">20</span>
                            </div>
                            <input type="range" id="agentMinSpeedSlider" min="10" max="30" value="20" step="1" class="mt-2">
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="agentMaxSpeedSlider" class="block text-md font-medium text-slate-700">Max Agent Speed (km/h):</label>
                                <span id="agentMaxSpeedValue" class="font-bold text-xl text-blue-700">30</span>
                            </div>
                            <input type="range" id="agentMaxSpeedSlider" min="20" max="50" value="30" step="1" class="mt-2">
                        </div>
                        <div>
                            <div class="control-label">
                                <label for="handlingTimeSlider" class="block text-md font-medium text-slate-700">Store Handling Time (min):</label>
                                <span id="handlingTimeValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="handlingTimeSlider" min="1" max="15" value="5" step="1" class="mt-2">
                        </div>
                        <div class="input-group"> <label for="orderGenerationProfileSelect" class="block text-md font-medium text-slate-700">Order Generation Profile:</label>
                            <select id="orderGenerationProfileSelect" class="mt-1">
                                <option value="default_uniform" selected>Default: Uniform City-Wide</option>
                                <option value="default_focused">Default: Focused Around Dark Store</option>
                            </select>
                        </div>
                        <div id="uniformOrderRadiusContainer" class="input-group hidden">
                            <div class="control-label">
                                <label for="uniformOrderRadiusKmSlider" class="block text-md font-medium text-slate-700">Uniform Order Radius (km):</label>
                                <span id="uniformOrderRadiusKmValue" class="font-bold text-xl text-blue-700">5</span>
                            </div>
                            <input type="range" id="uniformOrderRadiusKmSlider" min="1" max="10" value="5" step="0.5" class="mt-2">
                        </div>
                        <div id="defaultOrderSpreadContainer" class="hidden"> <div class="control-label">
                                <label for="orderSpreadSlider" class="block text-md font-medium text-slate-700">Order Location Spread (Default):</label>
                                <span id="orderSpreadValue" class="font-bold text-xl text-blue-700">Medium</span>
                            </div>
                            <input type="range" id="orderSpreadSlider" min="1" max="5" value="3" class="mt-2">
                             <div class="text-xs text-slate-500 flex justify-between mt-1 px-1"><span>Closer</span><span></span><span>Wider</span></div>
                        </div>
                        <div id="defaultOrderFocusRadiusContainer" class="input-group hidden"> <div class="control-label">
                                <label for="defaultOrderFocusRadiusSlider" class="block text-md font-medium text-slate-700">Focus Radius (km - Default):</label>
                                <span id="defaultOrderFocusRadiusValue" class="font-bold text-xl text-blue-700">3</span>
                            </div>
                            <input type="range" id="defaultOrderFocusRadiusSlider" min="1" max="5" value="3" step="0.5" class="mt-2">
                        </div>
                         <div class="input-group">
                            <label for="routeWaypointsSelect" class="block text-md font-medium text-slate-700">Route Complexity (Waypoints):</label>
                            <select id="routeWaypointsSelect" class="mt-1">
                                <option value="0">0 (Straight Lines)</option>
                                <option value="1" selected>1 Waypoint</option>
                                <option value="2">2 Waypoints</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="manualTrafficControl" class="block text-md font-medium text-slate-700">Base Traffic Condition:</label>
                            <select id="manualTrafficControl" class="mt-1">
                                <option value="1.0" selected>Medium (Normal)</option>
                                <option value="1.2">Light</option> <option value="0.7">Heavy</option> </select>
                        </div>
                        <div class="input-group checkbox-group items-center">
                            <input type="checkbox" id="enableDynamicTraffic" class="mr-2">
                            <label for="enableDynamicTraffic" class="text-md font-medium text-slate-700 cursor-pointer">Enable Dynamic Traffic</label>
                        </div>
                        <div class="input-group">
                            <label for="agentCostPerHour" class="block text-md font-medium text-slate-700">Agent Cost/Hour (₹):</label>
                            <input type="number" id="agentCostPerHour" value="150" min="0" step="10" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="costPerKmTraveled" class="block text-md font-medium text-slate-700">Cost/km Traveled (₹):</label>
                            <input type="number" id="costPerKmTraveled" value="5" min="0" step="0.5" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="fixedCostPerDelivery" class="block text-md font-medium text-slate-700">Fixed Cost/Delivery (₹):</label>
                            <input type="number" id="fixedCostPerDelivery" value="10" min="0" step="1" class="w-full">
                        </div>
                    </div>
                </div>
                <div class="text-center text-slate-600 mb-4">
                    Simulation Time: <span id="simTimeDisplay" class="font-semibold text-3xl text-slate-800">0</span> minutes
                    (<span id="currentTrafficStatus" class="text-sm">Traffic: Normal</span>)
                </div>
                <div class="grid lg:grid-cols-3 gap-x-8 gap-y-8">
                    <div class="lg:col-span-2 space-y-6">
                        <div id="simulationMap" class="w-full shadow-2xl rounded-xl overflow-hidden border-2 border-slate-200"></div>
                        <div class="flex flex-col sm:flex-row items-center justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button id="startSimBtn" class="btn btn-primary w-full sm:flex-1">Start Simulation</button>
                            <button id="pauseSimBtn" class="btn btn-secondary w-full sm:flex-1">Pause Simulation</button>
                             <button id="resetSimBtn" class="btn btn-danger w-full sm:flex-1">Reset Simulation</button>
                        </div>
                        <div class="mt-4 text-center input-group checkbox-group justify-center">
                            <input type="checkbox" id="toggleDeliveryTimeHeatmap" class="mr-2">
                            <label for="toggleDeliveryTimeHeatmap" class="text-md font-medium text-slate-700 cursor-pointer">Show Delivery Time Heatmap</label>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4 mt-4">
                            <div class="live-chart-container">
                                <h5>Pending Orders Over Time</h5>
                                <canvas id="pendingOrdersChart"></canvas>
                            </div>
                            <div class="live-chart-container">
                                <h5>Active Agents Over Time</h5>
                                <canvas id="activeAgentsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 space-y-6">
                        <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Agent Status</h4>
                            <div id="agentStatusList" class="space-y-2 text-sm max-h-60 overflow-y-auto log-container p-4 bg-white rounded-lg border border-slate-200">
                                <p class="text-slate-500 italic">Agents will appear here...</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Active Orders</h4>
                            <div id="pendingOrdersList" class="space-y-2 text-sm max-h-60 overflow-y-auto log-container p-4 bg-white rounded-lg border border-slate-200">
                                <p class="text-slate-500 italic">Active orders will appear here...</p>
                            </div>
                        </div>
                         <div class="stat-card">
                            <h4 class="font-semibold text-xl mb-3 text-slate-700">Simulation Log</h4>
                            <div id="simulationLog" class="simulation-log text-xs space-y-1.5 h-72 overflow-y-auto bg-slate-900 text-slate-300 p-4 rounded-lg log-container font-mono">
                                <p class="log-system"><em>[SYS] Simulation log initialized.</em></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="simulationOverallStats" class="simulation-stats-container">
                    <h4 class="text-2xl font-semibold text-center">Simulation Statistics</h4>
                    <div class="simulation-stats-grid">
                        <p><strong >Total Orders Generated:</strong> <span id="statsTotalOrdersGenerated">0</span></p>
                        <p><strong >Total Orders Delivered:</strong> <span id="statsTotalOrdersDelivered">0</span></p>
                        <p><strong >Avg. Delivery Time:</strong> <span id="statsAvgDeliveryTime">N/A</span></p>
                        <p><strong >Min Delivery Time:</strong> <span id="statsMinDeliveryTime">N/A</span></p>
                        <p><strong >Max Delivery Time:</strong> <span id="statsMaxDeliveryTime">N/A</span></p>
                        <p><strong >Std. Dev. Delivery Time:</strong> <span id="statsStdDevDeliveryTime">N/A</span></p>
                        <p><strong >Avg. Order Wait Time:</strong> <span id="statsAvgOrderWaitTime">N/A</span></p>
                        <p><strong >Avg. Agent Utilization:</strong> <span id="statsAvgAgentUtilization">N/A</span></p>
                        <p><strong >Total Agent Travel Time:</strong> <span id="statsTotalAgentTravelTime">0</span> min</p>
                        <p><strong >Total Agent Handling Time:</strong> <span id="statsTotalAgentHandlingTime">0</span> min</p>
                        <p><strong >Total Simulation Runtime:</strong> <span id="statsTotalSimTime">0</span> min</p>
                    </div>
                    <div class="cost-kpi-grid">
                        <p><strong>Total Agent Labor Cost:</strong> <span id="statsTotalAgentLaborCost">₹0.00</span></p>
                        <p><strong>Total Travel Cost:</strong> <span id="statsTotalTravelCost">₹0.00</span></p>
                        <p><strong>Total Fixed Delivery Costs:</strong> <span id="statsTotalFixedDeliveryCosts">₹0.00</span></p>
                        <p><strong>Overall Total Operational Cost:</strong> <span id="statsOverallTotalOperationalCost">₹0.00</span></p>
                        <p><strong>Average Cost per Order:</strong> <span id="statsAverageCostPerOrder">N/A</span></p>
                    </div>
                    <div class="mt-6 flex justify-center space-x-3">
                        <button id="saveCurrentSimScenarioBtn" class="btn btn-secondary">Save Current Scenario Results</button>
                        <button id="exportSimResultsBtn" class="btn btn-primary">Export Results (CSV)</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="workforceOptimization" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Workforce Optimization Analysis</h2>
                <div class="bg-teal-50 border-l-4 border-teal-500 text-teal-700 p-4 mb-6 rounded-md shadow" role="alert">
                     <details>
                        <summary class="font-bold text-lg text-teal-700 hover:text-teal-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">
                                This tool helps you find a smart balance for your delivery team size. Instead of just picking a number of agents, it analyzes how different team sizes impact delivery speed, customer service (getting orders on time), agent workload (utilization), and overall costs.
                            </p>
                            <p class="font-bold text-lg mt-3 mb-2">How does it work now?</p>
                            <p class="text-base leading-relaxed">
                                You set a target for average delivery time. The tool then runs many quick simulations for different numbers of agents (from a minimum to a maximum you define). For each simulated agent count, it tracks:
                            </p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li>Average delivery time.</li>
                                <li>The percentage of orders delivered *within* your target average delivery time (Service Level).</li>
                                <li>How busy the agents are (Average Agent Utilization).</li>
                                <li>The average cost to deliver each order.</li>
                            </ul>
                            <p class="text-base leading-relaxed mt-2">
                                The "Best Scenario" is chosen by first finding agent counts that meet a good service level (e.g., many orders delivered on time) and ensure a high rate of order completion. Then, from those good options, it picks the one with the lowest average cost per order. If costs are similar, it prefers a configuration where agents are well-utilized (e.g., between 60-90%) to avoid overstaffing (low utilization, high idle costs) or overworking agents (very high utilization, risk of burnout).
                            </p>
                             <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                             <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li>Make sure you've run "Clustering" first to have dark stores available.</li>
                                <li>Set your desired "Target Avg. Delivery Time".</li>
                                <li>Choose a "Dark Store" to optimize for.</li>
                                <li>Define the "Min/Max Orders per Iteration" for the test runs.</li>
                                <li>Specify the "Min Agents" and "Max Agents" to test.</li>
                                <li>Click "Run Workforce Optimization".</li>
                            </ul>
                            <p class="font-bold text-lg mt-3 mb-2">What you'll see:</p>
                            <p class="text-base leading-relaxed">
                                You'll get a detailed comparison table and charts showing how performance changes with different numbers of agents. The "Optimization Recommendation" section will highlight a recommended agent count based on balancing service, cost, and utilization, along with an explanation. You can also "Export Optimization Results (CSV)" for further analysis.
                            </p>
                        </div>
                    </details>
                </div>

                <div class="mb-8 p-6 border-2 border-blue-200 rounded-xl bg-blue-50 shadow-md">
                    <h3 class="text-2xl font-semibold mb-4 text-blue-700">Optimization Parameters</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="optTargetDeliveryTime">Target Avg. Delivery Time (min):</label>
                            <input type="number" id="optTargetDeliveryTime" value="15" min="5" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optSelectDarkStore">Select Dark Store for Scenario:</label>
                            <select id="optSelectDarkStore" class="w-full">
                                <option value="">-- Run Clustering First --</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="optOrderGenerationRadius">Order Generation Radius from Store (km):</label>
                            <input type="number" id="optOrderGenerationRadius" value="5" min="0.5" step="0.5" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMinOrdersPerIteration">Min Orders per Iteration:</label>
                            <input type="number" id="optMinOrdersPerIteration" value="8" min="1" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMaxOrdersPerIteration">Max Orders per Iteration:</label>
                            <input type="number" id="optMaxOrdersPerIteration" value="12" min="1" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMinAgents">Min Agents to Test:</label>
                            <input type="number" id="optMinAgents" value="1" min="1" max="25" step="1" class="w-full">
                        </div>
                        <div class="input-group">
                            <label for="optMaxAgents">Max Agents to Test:</label>
                            <input type="number" id="optMaxAgents" value="15" min="1" max="25" step="1" class="w-full">
                        </div>
                         <div class="input-group md:col-span-2">
                            <label for="optMaxSimTimePerIteration">Max Sim Time per Iteration (min):</label>
                            <input type="number" id="optMaxSimTimePerIteration" value="120" min="1" step="1" class="w-full">
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="runOptimizationBtn" class="btn btn-primary">Run Workforce Optimization</button>
                    </div>
                </div>
                <div id="optimizationMapContainer" class="mb-6 shadow-xl rounded-xl overflow-hidden border-2 border-slate-200 hidden">
                     <h4 class="text-xl font-semibold text-center p-4 bg-slate-100 border-b border-slate-300">Scenario Map (Optimal Configuration)</h4>
                    <div id="optimizationMapViz" class="w-full"></div>
                </div>
                <div id="optimizationComparisonContainer" class="optimization-results-container hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-2xl font-semibold">Iteration Comparison Table</h4>
                        <button id="exportWorkforceOptResultsBtn" class="btn btn-secondary btn-sm">Export Table (CSV)</button>
                    </div>
                    <div class="comparison-table-container">
                        <table id="optimizationComparisonTable" class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Agents</th>
                                    <th>Target Orders This Iter.</th> <th>Generated Orders</th>
                                    <th>Delivered Orders</th>
                                    <th>Avg. Delivery Time (min)</th>
                                    <th>% Orders within Target Time</th>
                                    <th>Min Delivery Time (min)</th>
                                    <th>Max Delivery Time (min)</th>
                                    <th>Std. Dev. Delivery Time (min)</th>
                                    <th>Avg. Agent Utilization (%)</th>
                                    <th>Avg. Order Wait Time (min)</th>
                                    <th>Undelivered Orders</th>
                                    <th>Total Op. Cost (₹)</th>
                                    <th>Avg. Cost/Order (₹)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                 <div id="optimizationChartsContainer" class="hidden mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Delivery Time</h4>
                        <canvas id="deliveryTimeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Utilization</h4>
                        <canvas id="utilizationChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Total Delivered Orders</h4>
                        <canvas id="totalDeliveredOrdersChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. Avg. Order Wait Time</h4>
                        <canvas id="avgOrderWaitTimeChart"></canvas>
                    </div>
                    <div class="chart-container md:col-span-2">
                        <h4 class="text-xl font-semibold text-center mb-2">Agents vs. % Orders within Target Time</h4>
                        <canvas id="ordersWithinSlaChart"></canvas>
                    </div>
                </div>
                <div id="optimizationResultsContainer" class="optimization-results-container hidden">
                    <h4 class="text-2xl font-semibold text-center">Optimization Recommendation</h4>
                    <div id="optimizationRecommendationText" class="mb-4 p-4 bg-sky-100 border border-sky-300 rounded-md text-sky-700">
                        <p>Recommendation will appear here based on balancing service level, cost, and agent utilization.</p>
                    </div>
                    <div class="optimization-results-grid">
                        <p><strong >Recommended Agents:</strong> <span id="optResultAgents">N/A</span></p>
                        <p><strong >Achieved Avg. Delivery Time:</strong> <span id="optResultAvgTime">N/A</span></p>
                        <p><strong >Target Avg. Delivery Time:</strong> <span id="optResultTargetTime">N/A</span></p>
                        <p><strong >% Orders within Target:</strong> <span id="optResultSlaMet">N/A</span></p>
                        <p><strong >Avg. Agent Utilization:</strong> <span id="optResultAvgUtilization">N/A</span></p>
                        <p><strong >Avg. Order Wait Time:</strong> <span id="optResultAvgWaitTime">N/A</span></p>
                        <p><strong >Undelivered Orders:</strong> <span id="optResultUndelivered">N/A</span></p>
                    </div>
                    <div class="cost-kpi-grid">
                        <p><strong>Total Agent Labor Cost:</strong> <span id="optResultTotalAgentLaborCost">₹0.00</span></p>
                        <p><strong>Total Travel Cost:</strong> <span id="optResultTotalTravelCost">₹0.00</span></p>
                        <p><strong>Total Fixed Delivery Costs:</strong> <span id="optResultTotalFixedDeliveryCosts">₹0.00</span></p>
                        <p><strong>Overall Total Operational Cost:</strong> <span id="optResultOverallTotalOperationalCost">₹0.00</span></p>
                        <p><strong>Average Cost per Order:</strong> <span id="optResultAverageCostPerOrder">N/A</span></p>
                    </div>
                    <div class="mt-4">
                        <h5 class="text-xl font-semibold text-slate-700 mb-2">Dark Store Analysis (for Recommended Scenario):</h5>
                        <ul id="optDarkStoreDistances" class="list-disc list-inside space-y-1">
                        </ul>
                        <p class="mt-2"><strong >Overall Avg. Order-to-Store Distance:</strong> <span id="optOverallAvgDistance">N/A</span></p>
                    </div>
                    <h5 class="text-xl font-semibold text-slate-700 mt-6 mb-2">Optimization Log:</h5>
                    <div id="optimizationLog" class="optimization-log">
                        <p class="log-system"><em>[SYS] Optimization process log will appear here...</em></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenarioAnalysis" class="content-section">
            <div class="card">
                <h2 class="text-4xl font-bold mb-6 text-slate-800 border-b-4 border-blue-500 pb-4">Scenario Analysis & Comparison</h2>
                 <div class="bg-purple-50 border-l-4 border-purple-500 text-purple-700 p-4 mb-6 rounded-md shadow" role="alert">
                     <details>
                        <summary class="font-bold text-lg text-purple-700 hover:text-purple-800">What is this section for? (Click to expand)</summary>
                        <div class="mt-2">
                            <p class="text-base leading-relaxed">This section allows you to compare the results of different simulation runs side-by-side. After running various simulations with different parameters (e.g., more agents, different order profiles, changed traffic), you can save those results and then come here to analyze their impact on performance and cost.</p>
                            <p class="font-bold text-lg mt-3 mb-2">How to use it:</p>
                            <ul class="list-disc list-inside ml-4 text-base leading-relaxed space-y-1">
                                <li>First, run one or more simulations in the "Simulation" tab. At the end of each simulation (or when you're satisfied with its run), click the "Save Current Scenario Results" button there.</li>
                                <li>Saved scenarios will appear in the "Saved Scenarios" list on the left of this page.</li>
                                <li>Select the checkboxes next to the scenarios you want to compare.</li>
                                <li>Click "Compare Selected". A table will appear on the right showing a detailed comparison of parameters and results for your chosen scenarios.</li>
                                <li>You can "Clear All Saved Scenarios" if you want to start fresh.</li>
                            </ul>
                            <p class="font-bold text-lg mt-3 mb-2">What you'll see:</p>
                            <p class="text-base leading-relaxed">A detailed table that helps you understand how changing different inputs (like number of agents or order arrival rates) affects outcomes like average delivery time, agent utilization, and total operational costs. This is useful for making strategic decisions about your logistics setup.</p>
                             <p class="text-sm mt-2 italic">Note: Scenarios are saved in your browser's local storage, so they will persist even if you close and reopen your browser (unless you clear your browser data).</p>
                        </div>
                    </details>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="md:col-span-1">
                        <h3 class="text-2xl font-semibold mb-4 text-blue-700">Saved Scenarios</h3>
                        <div id="savedScenariosListContainer">
                            <ul id="savedScenariosList">
                                <li class="italic text-slate-500">No scenarios saved yet.</li>
                            </ul>
                        </div>
                        <div class="mt-4 flex flex-col space-y-2">
                            <button id="compareSelectedScenariosBtn" class="btn btn-primary">Compare Selected</button>
                            <button id="clearAllScenariosBtn" class="btn btn-danger">Clear All Saved Scenarios</button>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <h3 class="text-2xl font-semibold mb-4 text-blue-700">Comparison Details</h3>
                        <div id="scenarioComparisonResultsContainer" class="hidden">
                             <div class="comparison-table-container">
                                <table id="scenarioComparisonTable" class="comparison-table">
                                    <thead>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                         <p id="scenarioComparisonPlaceholder" class="italic text-slate-500 mt-4">Select one or more scenarios from the list and click "Compare Selected" to see details.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center py-16 mt-12 bg-slate-900 text-slate-400">
        <p class="text-slate-300 text-lg">&copy; <span id="currentYear"></span> Rakshit Monga - IIM Sirmaur.</p>
        <p class="text-md mt-2">Chandigarh Last-Mile Logistics Optimization Project</p>
        <div class="mt-8">
            <button id="toggleSectorCoordsBtn" class="btn btn-secondary btn-sm">Show/Hide Sector Coordinates</button>
            <div id="sectorCoordinatesContainer" class="hidden mt-4 text-left max-w-2xl mx-auto bg-slate-800 p-4 rounded-lg text-sm">
                <h4 class="text-lg font-semibold text-slate-200 mb-2 text-center">Chandigarh Sector Coordinates (Approximate Centers)</h4>
                <pre id="sectorCoordinatesList" class="text-slate-300 whitespace-pre-wrap"></pre>
            </div>
        </div>
    </footer>

    <script type="module" src="js/main.js"></script>
</body>
</html>
